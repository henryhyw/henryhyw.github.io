<style>
  #music-icon {
    cursor: url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 512 512"%3E%3Cpath fill="%23ededed" stroke="%23616161" stroke-width="5" d="M499.1 6.3c8.1 6 12.9 15.6 12.9 25.7l0 72 0 264c0 44.2-43 80-96 80s-96-35.8-96-80s43-80 96-80c11.2 0 22 1.6 32 4.6L448 147 192 223.8 192 432c0 44.2-43 80-96 80s-96-35.8-96-80s43-80 96-80c11.2 0 22 1.6 32 4.6L128 200l0-72c0-14.1 9.3-26.6 22.8-30.7l320-96c9.7-2.9 20.2-1.1 28.3 5z"/%3E%3C/svg%3E') 8 8, auto;
  }
</style>

<div class="menu">
  <nav class="menu-content">
    {% for item in site.data.settings.menu %}
      <a href="{{ site.github.url }}/{{ item.url }}">{{ item.name }}</a>
    {% endfor %}
  </nav>
<!--   <nav class="social-icons">
    {% include social-icons.html %}
  </nav> -->
  <nav class="social-icons">
    <a id="music-icon" title="Play Music"><i class="fa fa-compact-disc" aria-hidden="true" style="font-size: 2em;"></i></a>
  </nav>
</div>

<audio id="background-music"></audio>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    const musicIcon = document.getElementById("music-icon");
    const music = document.getElementById("background-music");

    const songs = [
      '/assets/aud/uletali_pticami_gordymi.mp3',
      '/assets/aud/the_portrait.mp3',
      '/assets/aud/asphyxia.mp3',
      // Add more song paths here if needed
    ];

    function getRandomSong() {
      return songs[Math.floor(Math.random() * songs.length)];
    }

    function playSong(song) {
      console.log(`Playing song: ${song}`);
      music.src = song;
      music.play().catch(error => {
        console.log("Autoplay prevented. Waiting for user interaction.");
        // Update play status to false and stop spinning
        localStorage.setItem("musicPlaying", "false");
        musicIcon.querySelector("i").classList.remove("fa-spin");
        musicIcon.title = "Play Music";
      });
      musicIcon.querySelector("i").classList.add("fa-spin");
      musicIcon.title = "Pause Music";
    }

    function playRandomSong() {
      const randomSong = getRandomSong();
      console.log(`Random song selected: ${randomSong}`);
      localStorage.setItem("currentSong", randomSong);
      playSong(randomSong);
    }

    // Restore music state from localStorage
    const savedSong = localStorage.getItem("currentSong");
    const savedTime = localStorage.getItem("musicTime");
    const musicPlaying = localStorage.getItem("musicPlaying") === "true";

    if (savedSong) {
      console.log(`Restoring song: ${savedSong}`);
      music.src = savedSong;
      if (savedTime) {
        music.currentTime = savedTime;
        console.log(`Restoring time: ${savedTime}`);
      }
      if (musicPlaying) {
        music.play().catch(error => {
          console.log("Autoplay prevented. Waiting for user interaction.");
          // Update play status to false and stop spinning
          localStorage.setItem("musicPlaying", "false");
          musicIcon.querySelector("i").classList.remove("fa-spin");
          musicIcon.title = "Play Music";
        });
        musicIcon.querySelector("i").classList.add("fa-spin");
        musicIcon.title = "Pause Music";
        console.log("Music is playing");
      } else {
        musicIcon.title = "Play Music";
        console.log("Music is paused");
      }
    } else {
      musicIcon.title = "Play Music";
      console.log("No saved song, ready to play a new one");
    }

    musicIcon.addEventListener("click", function() {
      if (music.paused) {
        if (!music.src) {
          playRandomSong();
        } else {
          music.play().catch(error => {
            console.log("Autoplay prevented. Waiting for user interaction.");
            // Update play status to false and stop spinning
            localStorage.setItem("musicPlaying", "false");
            musicIcon.querySelector("i").classList.remove("fa-spin");
            musicIcon.title = "Play Music";
          });
          musicIcon.querySelector("i").classList.add("fa-spin");
          musicIcon.title = "Pause Music";
        }
        localStorage.setItem("musicPlaying", "true");
        console.log("Music started");
      } else {
        music.pause();
        musicIcon.querySelector("i").classList.remove("fa-spin");
        musicIcon.title = "Play Music";
        localStorage.setItem("musicPlaying", "false");
        console.log("Music paused");
      }
    });

    // Save music state before leaving the page
    window.addEventListener("beforeunload", function() {
      localStorage.setItem("musicTime", music.currentTime);
      localStorage.setItem("musicPlaying", !music.paused);
      if (music.src) {
        localStorage.setItem("currentSong", music.src);
        console.log(`Saving song: ${music.src}`);
      }
    });

    // Play next random song when the current one ends
    music.addEventListener("ended", function() {
      console.log("Song ended, playing next random song");
      playRandomSong();
    });

    // Automatically continue playback if it was playing before
    if (musicPlaying && savedSong) {
      music.play().catch(error => {
        console.log("Autoplay prevented on load. Waiting for user interaction.");
        // Update play status to false and stop spinning
        localStorage.setItem("musicPlaying", "false");
        musicIcon.querySelector("i").classList.remove("fa-spin");
        musicIcon.title = "Play Music";
      });
    }
  });
</script>